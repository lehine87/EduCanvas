# t-005 로그인 후 권한 문제 해결 중

> 흠... 그대로야. \
>  GoTrueClient.ts:235 Multiple GoTrueClient instances detected in the  
>  same browser context. It is not an error, but this should be avoided  
>  as it may produce undefined behavior when used concurrently under the  
>  same storage key.
> GoTrueClient @ GoTrueClient.ts:235
> SupabaseAuthClient @ SupabaseAuthClient.ts:6
> \_initSupabaseAuthClient @ SupabaseClient.ts:304
> SupabaseClient @ SupabaseClient.ts:107
> createClient @ index.ts:40
> testRLSPolicies @ page.tsx:171
> executeDispatch @ react-dom-client.development.js:16921
> runWithFiberInDEV @ react-dom-client.development.js:872
> processDispatchQueue @ react-dom-client.development.js:16971
> (anonymous) @ react-dom-client.development.js:17572
> batchedUpdates$1 @ react-dom-client.development.js:3312
> dispatchEventForPluginEventSystem @
> react-dom-client.development.js:17125
> dispatchEvent @ react-dom-client.development.js:21308
> dispatchDiscreteEvent @ react-dom-client.development.js:21276
> <button>
> exports.jsxDEV @ react-jsx-dev-runtime.development.js:345
> RLSTestPanel @ page.tsx:234
> react_stack_bottom_frame @ react-dom-client.development.js:23552
> renderWithHooksAgain @ react-dom-client.development.js:6863
> renderWithHooks @ react-dom-client.development.js:6775
> updateFunctionComponent @ react-dom-client.development.js:9069
> beginWork @ react-dom-client.development.js:10679
> runWithFiberInDEV @ react-dom-client.development.js:872
> performUnitOfWork @ react-dom-client.development.js:15677
> workLoopSync @ react-dom-client.development.js:15497
> renderRootSync @ react-dom-client.development.js:15477
> performWorkOnRoot @ react-dom-client.development.js:14941
> performWorkOnRootViaSchedulerTask @
> react-dom-client.development.js:16766
> performWorkUntilDeadline @ scheduler.development.js:45
> <RLSTestPanel>
> exports.jsxDEV @ react-jsx-dev-runtime.development.js:345
> AuthTestPanel @ page.tsx:158
> react_stack_bottom_frame @ react-dom-client.development.js:23552
> renderWithHooksAgain @ react-dom-client.development.js:6863
> renderWithHooks @ react-dom-client.development.js:6775
> updateFunctionComponent @ react-dom-client.development.js:9069
> beginWork @ react-dom-client.development.js:10679
> runWithFiberInDEV @ react-dom-client.development.js:872
> performUnitOfWork @ react-dom-client.development.js:15677
> workLoopSync @ react-dom-client.development.js:15497
> renderRootSync @ react-dom-client.development.js:15477
> performWorkOnRoot @ react-dom-client.development.js:14941
> performWorkOnRootViaSchedulerTask @
> react-dom-client.development.js:16766
> performWorkUntilDeadline @ scheduler.development.js:45
> <AuthTestPanel>
> exports.jsxDEV @ react-jsx-dev-runtime.development.js:345
> TestAuthPage @ page.tsx:463
> react_stack_bottom_frame @ react-dom-client.development.js:23552
> renderWithHooksAgain @ react-dom-client.development.js:6863
> renderWithHooks @ react-dom-client.development.js:6775
> updateFunctionComponent @ react-dom-client.development.js:9069
> beginWork @ react-dom-client.development.js:10679
> runWithFiberInDEV @ react-dom-client.development.js:872
> performUnitOfWork @ react-dom-client.development.js:15677
> workLoopSync @ react-dom-client.development.js:15497
> renderRootSync @ react-dom-client.development.js:15477
> performWorkOnRoot @ react-dom-client.development.js:14941
> performSyncWorkOnRoot @ react-dom-client.development.js:16781
> flushSyncWorkAcrossRoots_impl @ react-dom-client.development.js:16627  
>  flushSyncWork$1 @ react-dom-client.development.js:15247
> scheduleRefresh @ react-dom-client.development.js:113
> (anonymous) @ react-refresh-runtime.development.js:265
> performReactRefresh @ react-refresh-runtime.development.js:254
> applyUpdate @ helpers.ts:169
> (anonymous) @ helpers.ts:181
> [NEW] Explain Console errors by using Copilot in Edge: click

           to explain an error.
          Learn more
          Don't show again

AuthContext.tsx:38 Auth state change: SIGNED_IN admin@test.com

● 아, Multiple GoTrueClient 경고가 핵심 문제입니다! 이는 여러 개의
Supabase 클라이언트가 동시에 생성되어 서로 충돌하고 있다는 의미입니다.

문제를 확인해보니, RLSTestPanel에서 새로운 Supabase 클라이언트를
생성하고 있는데, 이것이 기존 AuthManager의 클라이언트와 충돌하고
있습니다.

● Read(src\app\test-auth\page.tsx)

⎿ Read 20 lines (ctrl+r to expand)

● 바로 여기가 문제입니다! RLSTestPanel에서 새로운 Supabase 클라이언트를  
 생성하고 있습니다. 이미 AuthManager에 있는 클라이언트를 재사용해야
합니다.

● Update(src\app\test-auth\page.tsx)

⎿ Updated src\app\test-auth\page.tsx with 1 addition and 1 removal  
 4 import { AuthProvider, useAuth } from
'@/contexts/AuthContext'
5 import { PermissionGuard, StudentWriteGuard, AdminOnly }  
 from '@/components/auth'
6 import { usePermissions } from '@/hooks/usePermissions'
7 - import { createClient } from '@supabase/supabase-js'
7 + import { supabase } from '@/lib/auth/supabaseAuth'
8
9 // 테스트용 컴포넌트들
10 function AuthTestPanel() {
