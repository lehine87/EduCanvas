# 학원관리 솔루션 개발 기획서 (Draft v0.1)
작성일: 2025-08-08 · 담당: PM/PO · 대상: 경영진/개발팀/디자인/QA

> 범위: 경쟁앱 매뉴얼 목차(정리본)를 바탕으로 **핵심 기능을 표준화**하고, **MVP~Phase별 로드맵**, **데이터모델/아키텍처**, **테스트/운영**까지 일관된 개발 기준을 제시합니다.

---

## 0. 제품 비전 & 성공지표
- **비전**: “중·고등 학원 운영의 모든 업무(입학→반배정→출결→수강료→결제→정산→통계)를 **한 화면**에서 자동화.”
- **핵심 약속(USP)**  
  1) **반·학생 드래그앤드롭 관리 + 자동 추천 배치**  
  2) **미납/수납/할인 자동화** 및 카카오 알림톡/문자 연동  
  3) **실시간 출결 기반 통지**와 **통계 대시보드**  
- **MVP 성공지표(KPI)**  
  - D7 Retention ≥ 60% (관리자 기준)  
  - 미납 알림 자동화로 **수납 회수율 +15%**  
  - 수납/결제 처리 평균 시간 **-40%** (기존 대비)  
  - 이슈 티켓 월 30건 이하(중대결함 0건)  

---

## 1. 사용자/권한(Persona & RBAC)
| 역할 | 주 사용 시나리오 | 권한 요약 |
|---|---|---|
| 원장(Owner) | 사업자/요금제/정책/정산/리포트 | 모든 리소스 읽기/쓰기, 결제/정산 승인 |
| 실장(Manager) | 반/학생/수납/메시지 운영 | 운영 리소스 읽기/쓰기, 제한적 설정 |
| 강사(Teacher) | 반·학생 조회, 출결/성적 입력 | 조회/등록(본인 반), 결제/정산 권한 없음 |
| 상담/행정(Staff) | 입학/전반/대기/문자 | 학생/반 일부 쓰기, 재무 읽기 제한 |
| 학부모/학생(User) | 모바일 결제/신청/알림 수신 | 본인 데이터 조회, 결제 |
| 회계(Accountant) | 수납/환불/증빙/정산 | 재무 리소스 쓰기, 운영 읽기 |

**RBAC 원칙**: 리소스 단위(학생/반/수납/결제/메시지/리포트)에 CRUD 권한을 부여하고, **감사로그** 의무화.

---

## 2. 범위 정의 (MVP → Phase별)
### 2.1 MVP (3개월 목표)
- **조직/사업자/채널**: 다중사업자(기본), 카카오 채널 연결, 발신번호 등록
- **학생/반 관리**: 반 생성, 학생 입학/전반/퇴원, **드래그앤드롭 이동**, 대기생 입학
- **출결**: 출결 모드(기본/시간표 기준), 반별 출결조회, 알림톡(도착/출발)
- **수강료/청구**: 반·주차·회차·월 기준 수강료 정책, 자동 발생/할인/미납 관리
- **결제/수납**: 모바일결제(PG/NONPG), 가상계좌, 카드단말 연동(로그 기반), 환불(규칙)
- **메시징**: 알림톡/문자 템플릿, 예약/재전송, 실패내역 리포팅
- **리포트**: 일일 현황/미납 현황/매출 요약
- **권한/감사**: RBAC, Audit Log, 기본 알림 정책
- **개인정보 동의**: 수집/이용 동의 관리(기본)

### 2.2 Phase 2 (＋2~3개월)
- **통계/추천**: 자동 정렬/입반 추천(간단 규칙→통계 기반), 반별 포화도 예측
- **시험/성적**: 시험세트/성적 입력/기초 통계, 성적표 구성, OMR 결과 연동(수동 업로드)
- **교재/재고**: 교재 재고/판매/반배정
- **인터넷전화(CTI)**: 착신 팝업, 통화로그 저장(통신사/교환기 연동 방식 중 택1)
- **현금영수증**: 연동/비연동 발행 및 증빙 관리

### 2.3 Phase 3 (＋3개월)
- **키오스크/카드키**: 출석체크, 영수증 출력
- **차량/노선**: 노선 관리/탑승자 현황
- **진단평가/OMR 자동화**: 채점 파이프라인 고도화
- **모바일 설명회/수강신청**: 랜딩+접수+자동 배정

---

## 3. 기능 요구사항(요약)
### 3.1 학생/반/시간표
- 학생 라이프사이클: 대기→입학→반배정/전반→휴원→퇴원
- 반 유형(정규/선택/독서실), 시간표(요일/시간/강의실/강사) 관리
- DnD로 **학생 이동**(반 내/반 간), **자동 추천**(인원/레벨/요일 충돌 최소화)

### 3.2 출결/알림
- 출결 모드: 기본 / 시간표기준 / 카드시스템 시간기준
- 이벤트: `도착`, `출발`, `결석`, `지각` → 알림톡/문자 즉시/지연 발송
- 장애대응: 알림 실패시 재시도(지수백오프), 수신거부/스팸 대응

### 3.3 수강료/청구/할인/미납
- 정책: 월/주차/회차/패키지 + 반·학생 개별가 + 형제/기간/즉시할인
- 자동 발생: 기준일 전 N일 알림 → 청구 생성 → 미납 추적(스마트 리마인드)
- 이월/원단위 절사/입금형태(현금/계좌/카드/지역화폐) 표준화

### 3.4 결제/수납/환불
- **PG/가상계좌/단말기 로그연동**(토큰화, 우리 DB는 카드정보 미보관)
- 부분수납/부분환불, PG 실패/중복 알림 처리, 해외 결제 가능여부 정책
- 회계증빙: 영수증/현금영수증(연동/비연동), 납입증명서

### 3.5 메시징(알림톡/SMS/LMS)
- 템플릿: 수강료 청구/미납, 출결, 공지, 상담예약
- 발송 정책: 속도제한/쿼터, 예약/취소, 재전송, 실패 사유 로그
- 채널: 카카오 채널 연결/검증, 발신번호 관리

### 3.6 리포트/분석
- 대시보드: 오늘 출결/미납/매출/상담 요약
- 리포트: 반별 수강원생, 신규/퇴원, 사업자별 매출, 수납/환불, 미납 추이
- 내보내기: CSV/XLSX, 공유 링크(만료 토큰)

### 3.7 권한/보안/감사
- RBAC(역할 기반) + 리소스 스코프(사업자/캠퍼스/반)
- 개인정보 최소화/가명처리, **감사로그(Who/What/When/Where)** 전 리소스

---

## 4. 비기능 요구사항(NFR)
- **성능**: SLO 응답 95p ≤ 300ms(핵심 조회), 배치 ≤ 15분 내 완료
- **가용성**: 99.9%/월, 무중단 배포(Blue-Green/Canary)
- **보안**: OAuth2.1, JWT(짧은 수명)+ROT, 비밀번호 Argon2, 전 구간 TLS, PII 암호화
- **규정**: 개인정보보호법 준수(동의/철회/목적·보관기간/파기), 카드정보 미저장(PCI DSS는 PG측)
- **감사/관제**: 중앙 로깅(PII 마스킹), 이상징후 알람, 백업 RPO ≤ 1h, RTO ≤ 4h

---

## 5. 아키텍처 제안
```
[Next.js (App Router, SSR/ISR)]  ──>  [BFF/API Gateway]
          |                                   |
 [Zustand 상태]                         [Service Layer: 학생/반/출결/청구/결제/메시지]
          |                                   |
   [@dnd-kit]                           [Job Queue: BullMQ/Redis]
          |                                   |
        UI/UX                          [Integrations]
                                           ├─ PG(카드/가상계좌)
                                           ├─ 카카오 알림톡/SMS
                                           ├─ CTI(인터넷전화/콜백)
                                           └─ 카드단말(영수증/로그)
```
- **DB**: PostgreSQL(Supabase) 우선, 읽기 부하 증가시 Read Replica
- **파일**: 이미지/엑셀 업로드(S3 호환)
- **메시지 큐**: 재시도/스케줄/대량발송 처리
- **웹훅**: PG/CTI 수신 엔드포인트

---

## 6. 핵심 데이터 모델(요약)
| 테이블 | 주요 컬럼(예시) | 비고 |
|---|---|---|
| organizations | id, name, biz_no | 다중사업자 |
| users | id, role, name, phone | RBAC |
| guardians | id, name, phone | 학부모 |
| students | id, org_id, status, school, grade | 상태: 대기/재원/휴원/퇴원 |
| classes | id, org_id, type, name, schedule | type: 정규/선택/독서실 |
| enrollments | id, student_id, class_id, status | 전반 이력 |
| attendance | id, enrollment_id, at, status | 도착/출발/결석/지각 |
| fee_policies | id, scope, cycle, amount, rules | 월/주차/회차/개별 |
| invoices | id, student_id, due_date, total, status | 이월/할인 반영 |
| payments | id, invoice_id, method, amount, pg_tx_id | 카드/계좌/현금 |
| refunds | id, payment_id, amount, reason | 부분환불 |
| discounts | id, type, value, rule | 형제/즉시/기간 |
| messages | id, to, channel, template_id, status | 재시도/로그 |
| consents | id, student_id, type, signed_at | 개인정보 |
| exams | id, class_id, title | 시험세트 |
| scores | id, exam_id, student_id, score | 성적 |
| textbooks | id, sku, stock | 교재 |
| call_logs | id, from, to, meta | CTI |
| audit_logs | id, actor_id, action, resource, at | 전 리소스 |

---

## 7. 주요 사용자 여정(End-to-End)
1) **월 과금 사이클**  
- N일 전 알림 → 청구 자동 생성 → 알림톡 청구서 발송 → 결제 웹뷰 → 수납 반영 → 미납 N회 리마인드 → 이월/페널티 규칙

2) **출결-보호자 통지**  
- 카드/키오스크/앱 체크인 → 이벤트 발행 → 알림톡(도착) 즉시 발송 → 결석/지각 규칙에 따른 추가 통지

3) **전반/배치 추천**  
- 반별 정원/레벨/요일 충돌 체크 → 후보 반 점수화 → DnD 시 추천 스냅핑/경고

---

## 8. API 스펙(샘플)
- `POST /students` (입학)  
- `POST /enrollments/{id}/transfer` (전반)  
- `POST /invoices/generate?cycle=monthly&org_id=…`  
- `POST /payments/pg/callback` (웹훅)  
- `POST /messages/send` (채널=알림톡/SMS)  
- `GET /reports/arrears` (미납 현황)

> 전 API는 **idempotency-key** 지원, PII 마스킹, 감사로그 기록.

---

## 9. UI 정보구조(IA)
- **대시보드**(오늘 출결/미납/매출)
- **학생**(목록/상세/메모/이력)
- **반/시간표**(DnD 보드, 컬럼 커스텀)
- **출결**(실시간/통계/설정)
- **수강료·청구**(정책/청구/미납/할인)
- **결제/수납**(PG/계좌/단말, 환불)
- **메시지**(템플릿/발송/로그)
- **리포트**
- **설정**(사업자/권한/채널/현금영수증/웹훅)

---

## 10. 테스트 전략
- **요구사항 기반 시나리오** + **엣지케이스 카탈로그**(이월/부분환불/중복결제/발송실패)
- 단위/통합/E2E(Playwright) + 퍼포먼스(k6), 가상 PG/알림톡 모킹
- UAT: 원장/실장 그룹 5곳 베타(2주)

---

## 11. 마이그레이션/운영
- **CSV 인입 마법사**: 학생/반/수납/미납/메시지 템플릿
- **모니터링**: ApDex, 큐 적체, 발송 실패율, PG 오류율, 일일 현황 자동 리포트
- **백업**: PITR, 일/주 스냅샷, 재해복구 리허설 분기 1회

---

## 12. 리스크 & 대응
- 통신사/CTI 연동 불안정 → **교환기 독립(Asterisk/SIP) or 베ンダ API** 이원화
- PG 정산/환불 규칙 상이 → **PG 어댑터 레이어**로 표준화
- 알림톡 심사/템플릿 지연 → **SMS/LMS 폴백**
- 개인정보/동의 위반 리스크 → **최소수집/만료/파기 자동화**

---

## 13. 로드맵 & 마일스톤(예시)
| 마일스톤 | 기간 | 산출물 |
|---|---|---|
| M0 기초 | 2주 | RBAC/조직/채널/설정, 스캐폴딩 |
| M1 코어 | 4주 | 학생/반/DnD/출결/알림 |
| M2 과금 | 4주 | 수강료정책/청구/결제/환불 |
| M3 메시지 | 2주 | 템플릿/예약/로그/대량발송 |
| M4 리포트 | 2주 | 대시보드/CSV 내보내기 |
| M5 확장 | 6주 | 시험/교재/CTI/현금영수증 |

---

## 14. 스코프 추적(Backlog 샘플)
- [MVP-MUST] 학생 DnD 이동, 자동 추천(룰 기반)  
- [MVP-MUST] 월/회차/주차 수강료 정책 + 청구 생성  
- [MVP-MUST] PG/가상계좌 결제 + 환불(부분)  
- [MVP-MUST] 출결 이벤트 → 알림톡 실시간 발송  
- [MVP-MUST] 미납 리마인드 시나리오(1,3,7일 규칙)  
- [MVP-MUST] 리포트(미납/매출/일일현황)  
- [SHOULD] 단말기/현금영수증/대기생 자동 입학  
- [COULD] CTI/키오스크/차량/OMR  

---

### 부록 A. 경쟁목차 → 모듈 매핑(요약)
- **모바일 결제/현금영수증/가상계좌/신용카드/티켓** → 결제·정산 모듈
- **출결/키오스크** → 출결/알림 모듈
- **수강료/미납자/수입지출/회차/할인** → 과금·청구 모듈
- **학생/대기생/반/강사** → 운영 코어(학생·반·권한)
- **문자/알림톡/카카오채널/인터넷전화** → 메시징/CTI 모듈
- **시험/OMR/진단평가/교재** → 교육 운영 확장
- **연말정산/리포트** → 리포팅/회계 보조

---

> 본 문서는 MVP 킥오프를 위한 **요구사항 기준서** 겸 **아키텍처 지침**입니다. 다음 단계에서는 각 기능별 **유저스토리 + 수용기준(AC)**, **API 계약서(AsyncAPI/OpenAPI)**, **화면 설계서(Figma)**로 세분화합니다.
