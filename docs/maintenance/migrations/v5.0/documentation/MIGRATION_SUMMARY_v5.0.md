# EduCanvas v5.0 ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ë³´ê³ ì„œ

**ì™„ë£Œì¼**: 2025-08-25  
**ë§ˆì´ê·¸ë ˆì´ì…˜ ë²„ì „**: v4.1 â†’ v5.0  
**ë‹´ë‹¹**: Claude AI  
**ìƒíƒœ**: âœ… ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ

---

## ğŸ¯ ë§ˆì´ê·¸ë ˆì´ì…˜ ëª©í‘œ (ì™„ë£Œ)

### âœ… í•µì‹¬ ì•„í‚¤í…ì²˜ ë³€ê²½
- **ëª©í‘œ**: user_profilesë¥¼ ìˆœìˆ˜í•œ "ì„œë¹„ìŠ¤ ì ‘ê·¼ ID" ì—­í• ë¡œ ì „í™˜
- **ê²°ê³¼**: classes.instructor_id â†’ tenant_memberships.id ì—°ê²°ë¡œ ë³€ê²½
- **í™•ì¥ì„±**: í–¥í›„ í•™ìƒ/í•™ë¶€ëª¨ ëª¨ë°”ì¼ì•±ë„ user_profiles ê¸°ë°˜ ì ‘ê·¼ ê°€ëŠ¥

### âœ… Staff Management í†µí•©
- **ëª©í‘œ**: ê°•ì‚¬/ì§ì› ì •ë³´ë¥¼ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜  
- **ê²°ê³¼**: tenant_memberships.staff_info JSONB í•„ë“œ ì¶”ê°€
- **ê¶Œí•œ**: admin, instructor, staff, viewer í†µí•© ì—­í•  ê´€ë¦¬

---

## ğŸ”„ ì‹¤í–‰ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

### 1ë‹¨ê³„: ë°ì´í„° ë°±ì—… ë° ì¤€ë¹„
- [x] classes í…Œì´ë¸” ë°±ì—… ìƒì„± (`classes_backup_20250825`)
- [x] ìƒˆë¡œìš´ ì»¬ëŸ¼ ì¶”ê°€ (`classes.new_instructor_id`)

### 2ë‹¨ê³„: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
- [x] Node.js ìŠ¤í¬ë¦½íŠ¸ë¡œ ë°ì´í„° ì´ì „ (`migrate_data.js`)
  - ê¸°ì¡´: instructor_id = `18108b90-f4dd-4c76-9487-d1af0106b664` (user_profiles.id)
  - ë³€ê²½: new_instructor_id = `2bc4e816-d404-488c-9a4a-0860d9b53348` (tenant_memberships.id)
- [x] "ì¤‘2 í˜„í–‰ë°˜" í´ë˜ìŠ¤ ì„±ê³µì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

### 3ë‹¨ê³„: ìŠ¤í‚¤ë§ˆ ë³€ê²½ (DDL)
- [x] **v4 ìŠ¤í¬ë¦½íŠ¸**: RLS ì •ì±… ì˜ì¡´ì„± í•´ê²° (CASCADE ì‚¬ìš©)
- [x] ê¸°ì¡´ instructor_id ì»¬ëŸ¼ ì‚­ì œ (ì˜ì¡´ì„± ìë™ ì‚­ì œ)
- [x] new_instructor_id â†’ instructor_id ì»¬ëŸ¼ëª… ë³€ê²½
- [x] ìƒˆë¡œìš´ FK ì œì•½ì¡°ê±´ ìƒì„± (tenant_memberships ì°¸ì¡°)

### 4ë‹¨ê³„: RLS ì •ì±… ì¬êµ¬ì„±
- [x] attendances í…Œì´ë¸” ì •ì±… ì¬ìƒì„± (3ê°œ)
- [x] student_video_access í…Œì´ë¸” ì •ì±… ì¬ìƒì„± (ì˜¬ë°”ë¥¸ students-classes ê´€ê³„ ë°˜ì˜)
- [x] students â†” classes ê´€ê³„ ìˆ˜ì • (student_enrollments í…Œì´ë¸” í™œìš©)

### 5ë‹¨ê³„: Staff Info êµ¬ì¡° ì¶”ê°€
- [x] tenant_memberships.staff_info JSONB ì»¬ëŸ¼ ì¶”ê°€
- [x] GIN ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
- [x] ê°•ì‚¬/ì§ì› ì¶”ê°€ ì •ë³´ ì €ì¥ êµ¬ì¡° ì™„ì„±

### 6ë‹¨ê³„: TypeScript íƒ€ì… ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
- [x] database.types.ts ì¬ìƒì„± (v5.0 ìŠ¤í‚¤ë§ˆ ë°˜ì˜)
- [x] staff.types.ts ì—…ë°ì´íŠ¸ (StaffInfo ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€)  
- [x] classes.ts íƒ€ì… ì—…ë°ì´íŠ¸ (instructor_id ì°¸ì¡° ê´€ê³„ ë³€ê²½)
- [x] index.ts í†µí•© export (v5.0 íƒ€ì… ì‹œìŠ¤í…œ)

---

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ê²°ê³¼

### âœ… ë°ì´í„° ë¬´ê²°ì„±
- **ì´ì „ëœ ë°ì´í„°**: 1ê°œ í´ë˜ìŠ¤ ("ì¤‘2 í˜„í–‰ë°˜")
- **ê°•ì‚¬ ì •ë³´**: ì´ìƒì¤€ (ê´€ë¦¬ì ì—­í• )
- **ê´€ê³„ ê²€ì¦**: classes â†’ tenant_memberships â†’ user_profiles ì—°ê²° í™•ì¸

### âœ… ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­
```sql
-- ë³€ê²½ ì „ (v4.1)
classes.instructor_id â†’ user_profiles.id

-- ë³€ê²½ í›„ (v5.0)  
classes.instructor_id â†’ tenant_memberships.id â†’ user_profiles.id
                                              â†“
                                         staff_info (JSONB)
```

### âœ… ìƒˆë¡œìš´ ê¸°ëŠ¥
- **í†µí•© ì§ì› ê´€ë¦¬**: `/main/staff` í˜ì´ì§€ì—ì„œ ëª¨ë“  ì§ì› í†µí•© ê´€ë¦¬
- **í™•ì¥ ê°€ëŠ¥í•œ staff_info**: ê¸‰ì—¬, ì…ì‚¬ì¼, ìê²©ì¦ ë“± ìœ ì—°í•œ ì •ë³´ ì €ì¥
- **ì—­í•  ê¸°ë°˜ ê¶Œí•œ**: admin, instructor, staff, viewer ì„¸ë¶„í™”

---

## ğŸ› ï¸ ì—…ë°ì´íŠ¸ëœ ë¬¸ì„œ

### í•µì‹¬ ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [x] `CLAUDE.md`: v5.0 ì•„í‚¤í…ì²˜ ë°˜ì˜, Supabase ì ‘ì† ê°€ì´ë“œ ì¶”ê°€
- [x] `docs/core/database_design.md`: v5.0 ì•„í‚¤í…ì²˜ ëŒ€ì „í™˜ ë‚´ìš© ì¶”ê°€
- [x] `docs/core/typescript-type-dictionary.md`: v5.0 íƒ€ì… ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
- [x] `docs/index.md`: ìƒˆë¡œìš´ Supabase ê°€ì´ë“œ ì¶”ê°€

### ìƒˆë¡œ ìƒì„±ëœ ë¬¸ì„œ  
- [x] `docs/guides/database/supabase-connection-guide.md`: ì™„ì „í•œ Supabase ì ‘ì† ê°€ì´ë“œ
  - CLI íƒ€ì… ìƒì„± ë°©ë²•
  - DDL ì‹¤í–‰ ë°©ë²• (Dashboard ì‚¬ìš©)
  - Node.js ë°ì´í„° ì¡°ì‘ ë°©ë²•
  - ì ‘ì† ì‹¤íŒ¨ í•´ê²° ê°€ì´ë“œ

---

## ğŸ‰ ì„±ê³µ ì§€í‘œ

### âœ… ì•„í‚¤í…ì²˜ ëª©í‘œ ë‹¬ì„±
- **user_profiles ìˆœìˆ˜í™”**: ì¸ì¦ë§Œ ë‹´ë‹¹, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬
- **Role-First ì•„í‚¤í…ì²˜**: tenant_memberships ì¤‘ì‹¬ ê¶Œí•œ ê´€ë¦¬
- **í™•ì¥ì„± í™•ë³´**: ëª¨ë°”ì¼ì•± í™•ì¥ ì‹œ user_profiles â†’ students ì—°ê²° ê°€ëŠ¥

### âœ… ê¸°ìˆ ì  ì•ˆì •ì„±
- **íƒ€ì… ì•ˆì „ì„±**: database.types.ts ìë™ ìƒì„±ìœ¼ë¡œ íƒ€ì… ì¼ê´€ì„± ë³´ì¥  
- **RLS ì •ì±…**: ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ì— ë§ëŠ” ë³´ì•ˆ ì •ì±… ì ìš©
- **ë ˆê±°ì‹œ í˜¸í™˜**: instructors í…Œì´ë¸” ìœ ì§€ë¡œ ê¸°ì¡´ ì°¸ì¡° ë³´ì¡´

### âœ… ê°œë°œ ìƒì‚°ì„±
- **ë¬¸ì„œí™” ì™„ë£Œ**: Supabase ì ‘ì†ë¶€í„° ì•„í‚¤í…ì²˜ê¹Œì§€ ì™„ì „ ê°€ì´ë“œ
- **í‘œì¤€í™”**: ì¼ê´€ëœ ì ‘ì† ë°©ë²• ë° ê°œë°œ ì›Œí¬í”Œë¡œìš° í™•ë¦½
- **ìë™í™”**: íƒ€ì… ìƒì„± ëª…ë ¹ì–´ í‘œì¤€í™”

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ê¶Œì¥ì‚¬í•­
1. **ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸**: `/main/staff` í˜ì´ì§€ ê¸°ëŠ¥ ê²€ì¦
2. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: staff_info JSONB ì¿¼ë¦¬ ì„±ëŠ¥ í™•ì¸
3. **ë¬¸ì„œ í™œìš©**: ìƒˆë¡œìš´ ê°œë°œìëŠ” `supabase-connection-guide.md` í•„ìˆ˜ ì°¸ì¡°

### í–¥í›„ í™•ì¥ì„±
- **ëª¨ë°”ì¼ ì•±**: user_profiles â†’ students ì—°ê²° êµ¬ì¡° í™œìš©
- **ì¶”ê°€ ì—­í• **: tenant_roles í…Œì´ë¸”ë¡œ ì»¤ìŠ¤í…€ ê¶Œí•œ ì¶”ê°€
- **ì§ì› ê¸°ëŠ¥**: staff_info í™œìš©í•œ ê¸‰ì—¬ ê´€ë¦¬, ìŠ¤ì¼€ì¤„ë§ ë“±

---

**ğŸ† ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ**: EduCanvas v5.0 Role-First Architecture ì™„ì„±!  
**ğŸ“‹ ë‹¤ìŒ ì ‘ì†**: `docs/guides/database/supabase-connection-guide.md` ì°¸ì¡°í•˜ì—¬ ì ‘ì†