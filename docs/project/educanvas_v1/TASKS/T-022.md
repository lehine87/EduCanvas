---
id: T-022
title: "@dnd-kit 라이브러리 세팅 및 기본 구현"
status: TODO
priority: P0
assignees: [Lead Dev]
estimate: 1.0d
due: 2025-09-10
sprint: S3
dependencies: [T-021]
labels: [classflow, drag-and-drop, core-feature]
---

# T-022: @dnd-kit 라이브러리 세팅 및 기본 구현

## 📋 작업 개요

EduCanvas의 킬러 기능인 ClassFlow 드래그앤드롭 시스템의 기반을 구축합니다. @dnd-kit 라이브러리를 활용하여 60fps 성능과 완벽한 접근성을 지원하는 드래그앤드롭 인터페이스의 핵심 구조를 만들어냅니다.

## 🎯 목적

- @dnd-kit 기반 고성능 드래그앤드롭 시스템 구축
- 학생 카드와 클래스 박스 간의 드래그앤드롭 상호작용 구현
- 60fps 성능 목표 달성을 위한 최적화된 기본 구조 확립
- 접근성을 고려한 키보드 네비게이션 기반 마련

## 🏗️ 구현 항목

### 1. @dnd-kit 라이브러리 설정
- [ ] DndContext 프로바이더 설정
- [ ] 드래그앤드롭 센서 구성 (마우스, 터치, 키보드)
- [ ] 충돌 감지 알고리즘 선택 (closestCenter)
- [ ] 접근성 설정 (announcements, screen reader 지원)

### 2. 핵심 컴포넌트 구조 설계
- [ ] DraggableStudentCard 컴포넌트 기본 구조
- [ ] DroppableClassBox 컴포넌트 기본 구조  
- [ ] DragOverlay 컴포넌트 (드래그 중 프리뷰)
- [ ] ClassFlowContainer 최상위 컨테이너

### 3. 상태 관리 아키텍처
- [ ] classflowStore (Zustand) 기본 구조 설계
- [ ] 드래그 상태 관리 (draggedStudent, targetClass)
- [ ] 낙관적 업데이트 구조 설계
- [ ] 에러 처리 및 롤백 메커니즘 기초

### 4. 기본 드래그앤드롭 플로우
```typescript
// 기본 드래그앤드롭 플로우
1. onDragStart: 드래그 시작 시 학생 정보 저장
2. onDragOver: 드래그 중 타겟 클래스 하이라이트
3. onDragEnd: 드롭 시 학생 이동 처리
4. 에러 처리: 실패 시 원상 복구
```

## ✅ 완료 기준 (Acceptance Criteria)

### 필수 기능
- [ ] 학생 카드를 드래그하여 다른 클래스로 이동 가능
- [ ] 드래그 중 시각적 피드백 (DragOverlay) 정상 동작
- [ ] 드롭 가능한 영역과 불가능한 영역 구분 표시
- [ ] 드래그앤드롭 취소 기능 (ESC 키)

### 성능 기준
- [ ] 100개 학생 카드에서 부드러운 드래그 동작 (60fps 유지)
- [ ] 드래그 시작 응답시간 < 100ms
- [ ] 메모리 누수 없음 (React DevTools로 확인)

### 접근성 기준
- [ ] 키보드로 드래그앤드롭 작업 가능 (Tab, Space, Arrow keys)
- [ ] 스크린 리더에서 드래그앤드롭 상황 적절히 안내
- [ ] 포커스 관리 정상 동작

## 🧪 테스트 케이스

### 1. 기본 드래그앤드롭 테스트
```typescript
// 테스트 시나리오
1. 학생 카드 선택 → 드래그 시작
2. 다른 클래스 박스로 이동 → 하이라이트 확인  
3. 드롭 → 학생 이동 완료 확인
```

### 2. 키보드 접근성 테스트
```typescript  
// 키보드 조작 테스트
1. Tab키로 학생 카드 포커스
2. Space키로 드래그 모드 진입
3. Arrow키로 이동 방향 선택
4. Enter키로 드롭 실행
```

### 3. 성능 테스트
```typescript
// 성능 측정
1. 100개 학생 카드 렌더링
2. 연속 드래그앤드롭 10회 수행
3. FPS 측정 → 60fps 이상 확인
4. 메모리 사용량 모니터링
```

### 4. 에러 처리 테스트
```typescript
// 에러 상황 테스트  
1. 드래그 중 네트워크 연결 끊김
2. 잘못된 드롭 위치에 드롭
3. 권한 없는 클래스로 이동 시도
4. → 모든 경우 적절한 에러 처리 확인
```

## 📁 파일 구조

```
src/
├── components/
│   └── classflow/
│       ├── ClassFlowContainer.tsx       # 최상위 컨테이너
│       ├── DraggableStudentCard.tsx     # 드래그 가능한 학생 카드
│       ├── DroppableClassBox.tsx        # 드롭 가능한 클래스 박스
│       ├── DragOverlay.tsx              # 드래그 중 오버레이
│       └── index.ts                     # 컴포넌트 exports
├── store/
│   └── classflowStore.ts                # 드래그앤드롭 전용 스토어
├── hooks/
│   └── useClassFlow.ts                  # 드래그앤드롭 로직 훅
└── types/
    └── classflow.ts                     # 드래그앤드롭 타입 정의
```

## 💻 핵심 구현 코드

### 1. ClassFlowContainer.tsx 기본 구조
```typescript
import { DndContext, DragEndEvent, DragStartEvent } from '@dnd-kit/core';
import { useClassFlowStore } from '@/store/classflowStore';

export function ClassFlowContainer({ children }: { children: React.ReactNode }) {
  const { startDrag, endDrag, draggedStudent } = useClassFlowStore();

  const handleDragStart = (event: DragStartEvent) => {
    const { active } = event;
    startDrag(active.id as string);
  };

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;
    
    if (over && active.id !== over.id) {
      endDrag(active.id as string, over.id as string);
    } else {
      endDrag(null, null); // 취소
    }
  };

  return (
    <DndContext
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      {children}
      <DragOverlay>
        {draggedStudent && (
          <StudentCard student={draggedStudent} isDragging />
        )}
      </DragOverlay>
    </DndContext>
  );
}
```

### 2. classflowStore.ts 기본 구조
```typescript
import { create } from 'zustand';
import { Student, Class } from '@/types/database';

interface ClassFlowState {
  // 드래그 상태
  draggedStudent: Student | null;
  targetClass: Class | null;
  
  // 학생 데이터 (최적화된 구조)
  studentsByClass: Map<string, Student[]>;
  
  // 액션
  startDrag: (studentId: string) => void;
  endDrag: (studentId: string | null, targetClassId: string | null) => void;
  moveStudent: (studentId: string, targetClassId: string) => Promise<void>;
}

export const useClassFlowStore = create<ClassFlowState>((set, get) => ({
  draggedStudent: null,
  targetClass: null,
  studentsByClass: new Map(),
  
  startDrag: (studentId) => {
    const student = findStudentById(studentId);
    set({ draggedStudent: student });
  },
  
  endDrag: async (studentId, targetClassId) => {
    if (studentId && targetClassId) {
      await get().moveStudent(studentId, targetClassId);
    }
    set({ draggedStudent: null, targetClass: null });
  },
  
  moveStudent: async (studentId, targetClassId) => {
    // 낙관적 업데이트 구현
    try {
      // UI 즉시 업데이트
      optimisticallyMoveStudent(studentId, targetClassId);
      
      // API 호출
      await moveStudentAPI(studentId, targetClassId);
      
    } catch (error) {
      // 실패 시 롤백
      revertStudentMove(studentId);
      throw error;
    }
  }
}));
```

## 🚨 위험 요소 및 완화 방안

### 높은 위험
**성능 저하 위험**
- 위험: 대량 데이터에서 드래그 응답 지연
- 완화: React.memo, useMemo 적극 활용, 가상화 적용 검토

**복잡한 상태 관리**
- 위험: 드래그앤드롭 중 상태 동기화 문제
- 완화: 단순한 상태 구조 설계, 철저한 테스트

### 중간 위험
**접근성 구현 복잡성**
- 위험: 키보드 네비게이션 구현 어려움
- 완화: @dnd-kit의 접근성 기능 최대 활용

## 📚 참고 문서

- [@dnd-kit Documentation](https://docs.dndkit.com/)
- [Performance Best Practices](https://docs.dndkit.com/guides/performance)
- [Accessibility Guidelines](https://docs.dndkit.com/guides/accessibility)
- [EduCanvas 기능요구서.md](../../docs/기능요구서.md)

## 🔄 후속 작업

이 태스크 완료 후 연결되는 작업들:
- T-023: StudentCard 컴포넌트 개발 (드래그 가능)
- T-024: ClassBox 컴포넌트 개발 (드롭 가능)  
- T-025: DragOverlay 애니메이션 구현
- T-026: 드래그앤드롭 기본 이동 로직 완성

---

**작성자**: Lead Dev  
**검토자**: Frontend Dev  
**마지막 업데이트**: 2025-08-08  
**관련 스프린트**: S3 (ClassFlow 드래그앤드롭)  
**관련 Epic**: ClassFlow 킬러 기능